<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pendataan Aset Sekolah - GitHub Pages Version</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        @media (max-width: 768px) {
            .responsive-table {
                font-size: 0.75rem;
            }
            .responsive-table th,
            .responsive-table td {
                padding: 0.25rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50" x-data="assetApp()">
    
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-school text-2xl"></i>
                    <h1 class="text-xl md:text-2xl font-bold">Sistem Pendataan Aset Sekolah</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <i class="fas fa-users"></i>
                    <span class="text-sm md:text-base" x-text="activeUsers"></span>
                    <span class="text-sm md:text-base">Pengguna Aktif</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Configuration Alert -->
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 m-4" x-show="!isConfigured">
        <div class="flex">
            <div class="flex-shrink-0">
                <i class="fas fa-exclamation-triangle text-yellow-400"></i>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Perlu Konfigurasi:</strong> Update Google Apps Script URL di file ini. 
                    Lihat <a href="#setup" class="underline">panduan setup</a> di bagian bawah.
                </p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        
        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex flex-wrap border-b">
                <button @click="activeTab = 'input'" 
                        :class="activeTab === 'input' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'"
                        class="px-4 py-3 font-medium transition-colors duration-200">
                    <i class="fas fa-plus-circle mr-2"></i>Input Data Aset
                </button>
                <button @click="activeTab = 'data'" 
                        :class="activeTab === 'data' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'"
                        class="px-4 py-3 font-medium transition-colors duration-200">
                    <i class="fas fa-database mr-2"></i>Data Aset
                </button>
                <button @click="activeTab = 'setup'" 
                        :class="activeTab === 'setup' ? 'border-b-2 border-blue-500 text-blue-600' : 'text-gray-600 hover:text-gray-800'"
                        class="px-4 py-3 font-medium transition-colors duration-200">
                    <i class="fas fa-cog mr-2"></i>Setup & Debug
                </button>
            </div>
        </div>

        <!-- Input Form Tab -->
        <div x-show="activeTab === 'input'" x-transition:enter="transition ease-out duration-300" 
             x-transition:enter-start="opacity-0 transform translate-y-4" 
             x-transition:enter-end="opacity-100 transform translate-y-0">
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-edit mr-2"></i>Form Input Data Aset
                </h2>
                
                <form @submit.prevent="submitForm()" class="space-y-4">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <!-- Kolom Kiri -->
                        <div class="space-y-4">
                            
                            <!-- Tanggal -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-calendar mr-1"></i>Tanggal
                                </label>
                                <input type="date" x-model="formData.tanggal" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Nomor Item -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-hashtag mr-1"></i>Nomor Item (Auto Generate)
                                </label>
                                <input type="text" x-model="formData.nomorItem" readonly
                                       class="w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md">
                                <button type="button" @click="generateNomorItem()" 
                                        class="mt-1 text-sm text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-sync mr-1"></i>Generate Nomor Baru
                                </button>
                            </div>

                            <!-- Nama Item -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-tag mr-1"></i>Nama Item
                                </label>
                                <input type="text" x-model="formData.namaItem" required
                                       placeholder="Masukkan nama item"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Jenis Item -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-list mr-1"></i>Jenis Item
                                </label>
                                <select x-model="formData.jenisItem" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Jenis Item</option>
                                    <option value="elektronik">Elektronik</option>
                                    <option value="mesin">Mesin</option>
                                    <option value="komputer">Komputer</option>
                                    <option value="perkakas">Perkakas</option>
                                    <option value="buku">Buku</option>
                                    <option value="mebeler">Mebeler</option>
                                    <option value="media belajar">MEDIA Belajar</option>
                                    <option value="alat seni">Alat Seni</option>
                                    <option value="alat olah raga">Alat Olah Raga</option>
                                    <option value="kesehatan">Kesehatan</option>
                                    <option value="lainnya">Lainnya</option>
                                </select>
                            </div>

                            <!-- Kondisi -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-clipboard-check mr-1"></i>Kondisi
                                </label>
                                <select x-model="formData.kondisi" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Kondisi</option>
                                    <option value="baru">Baru</option>
                                    <option value="baik">Baik</option>
                                    <option value="rusak ringan">Rusak Ringan</option>
                                    <option value="rusak parah">Rusak Parah</option>
                                </select>
                            </div>

                        </div>

                        <!-- Kolom Kanan -->
                        <div class="space-y-4">
                            
                            <!-- Bahan -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-cube mr-1"></i>Bahan
                                </label>
                                <select x-model="formData.bahan" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Bahan</option>
                                    <option value="metal">Metal</option>
                                    <option value="plastik">Plastik</option>
                                    <option value="kayu">Kayu</option>
                                    <option value="kertas">Kertas</option>
                                    <option value="lainnya">Lainnya</option>
                                </select>
                            </div>

                            <!-- Gedung -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-building mr-1"></i>Gedung
                                </label>
                                <select x-model="formData.gedung" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Gedung</option>
                                    <option value="gedung 1">Gedung 1</option>
                                    <option value="gedung 2">Gedung 2</option>
                                    <option value="gedung 3">Gedung 3</option>
                                    <option value="gedung 4">Gedung 4</option>
                                    <option value="gedung 5">Gedung 5</option>
                                    <option value="gedung 6">Gedung 6</option>
                                    <option value="gedung 7">Gedung 7</option>
                                </select>
                            </div>

                            <!-- Ruang -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-door-open mr-1"></i>Ruang
                                </label>
                                <select x-model="formData.ruang" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Ruang</option>
                                    <option value="ruang 1">Ruang 1</option>
                                    <option value="ruang 2">Ruang 2</option>
                                    <option value="ruang 3">Ruang 3</option>
                                    <option value="ruang 4">Ruang 4</option>
                                    <option value="ruang 5">Ruang 5</option>
                                    <option value="ruang 6">Ruang 6</option>
                                    <option value="ruang 7">Ruang 7</option>
                                    <option value="ruang 8">Ruang 8</option>
                                    <option value="ruang 9">Ruang 9</option>
                                    <option value="ruang 10">Ruang 10</option>
                                </select>
                            </div>

                            <!-- Rak -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-archive mr-1"></i>Rak
                                </label>
                                <input type="text" x-model="formData.rak"
                                       placeholder="Masukkan nomor/nama rak"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Pencatat -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    <i class="fas fa-user mr-1"></i>Pencatat
                                </label>
                                <select x-model="formData.pencatat" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">Pilih Pencatat</option>
                                    <option value="Ludiah Liling, S.Pd">Ludiah Liling, S.Pd</option>
                                    <option value="Riang Ardiansyah, S.Pd.I">Riang Ardiansyah, S.Pd.I</option>
                                    <option value="Irwan, S.Pd">Irwan, S.Pd</option>
                                    <option value="Sudin Lan, S. Pd">Sudin Lan, S. Pd</option>
                                    <option value="Gracella Feybe Everia Wuisan,S.Pd">Gracella Feybe Everia Wuisan,S.Pd</option>
                                    <option value="Yosep, S.Pd">Yosep, S.Pd</option>
                                    <option value="NUR REZKY, S. Pd">NUR REZKY, S. Pd</option>
                                    <option value="Selpiani Tumba' Limbong S.L, S.Pd.SD">Selpiani Tumba' Limbong S.L, S.Pd.SD</option>
                                    <option value="Nofiafi Ngau, S.Pd">Nofiafi Ngau, S.Pd</option>
                                    <option value="HASNI, S.Pd">HASNI, S.Pd</option>
                                    <option value="Nursaidah">Nursaidah</option>
                                    <option value="Nurjannah">Nurjannah</option>
                                    <option value="Noriati Anyie,S.E">Noriati Anyie,S.E</option>
                                    <option value="Jamaluddin, S.Pd">Jamaluddin, S.Pd</option>
                                    <option value="Greisye Dian Marulia Wuisan, S.A.P">Greisye Dian Marulia Wuisan, S.A.P</option>
                                    <option value="Denia Pitri Udau, SE">Denia Pitri Udau, SE</option>
                                    <option value="Ricki Krisnata">Ricki Krisnata</option>
                                    <option value="Ismail">Ismail</option>
                                    <option value="Muhamad Sirih">Muhamad Sirih</option>
                                    <option value="James Roymond Tommy HW, S.Pd">James Roymond Tommy HW, S.Pd</option>
                                </select>
                            </div>

                        </div>
                    </div>

                    <!-- Keterangan/Deskripsi -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <i class="fas fa-comment-dots mr-1"></i>Keterangan/Deskripsi
                        </label>
                        <textarea x-model="formData.keterangan" rows="3"
                                  placeholder="Masukkan keterangan atau deskripsi item"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- Foto -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            <i class="fas fa-camera mr-1"></i>Foto Aset
                        </label>
                        <div class="space-y-3">
                            <div class="flex flex-wrap gap-3">
                                <input type="file" x-ref="fileInput" @change="handleFileSelect($event)" 
                                       accept="image/*" capture="environment" class="hidden">
                                <button type="button" @click="$refs.fileInput.click()"
                                        class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors duration-200">
                                    <i class="fas fa-camera mr-2"></i>Ambil Foto
                                </button>
                                <button type="button" @click="openCamera()"
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
                                    <i class="fas fa-video mr-2"></i>Buka Kamera
                                </button>
                            </div>
                            
                            <!-- Preview Foto -->
                            <div x-show="formData.fotoPreview" class="mt-3">
                                <img :src="formData.fotoPreview" alt="Preview" class="max-w-full h-48 object-cover rounded-md shadow-md">
                                <div class="mt-2 flex items-center justify-between">
                                    <span class="text-sm text-gray-600" x-text="formData.fotoSize"></span>
                                    <button type="button" @click="removePhoto()" 
                                            class="text-red-600 hover:text-red-800 text-sm">
                                        <i class="fas fa-trash mr-1"></i>Hapus Foto
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Camera Modal -->
                            <div x-show="showCamera" x-transition class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
                                <div class="bg-white rounded-lg p-4 max-w-md w-full mx-4">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-semibold">Kamera</h3>
                                        <button @click="closeCamera()" class="text-gray-500 hover:text-gray-700">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <video x-ref="video" class="w-full rounded-md mb-4" autoplay></video>
                                    <canvas x-ref="canvas" class="hidden"></canvas>
                                    <div class="flex justify-center space-x-3">
                                        <button @click="capturePhoto()" 
                                                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                            <i class="fas fa-camera mr-2"></i>Capture
                                        </button>
                                        <button @click="closeCamera()" 
                                                class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">
                                            <i class="fas fa-times mr-2"></i>Batal
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        <button type="button" @click="resetForm()" 
                                class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors duration-200">
                            <i class="fas fa-redo mr-2"></i>Reset
                        </button>
                        <button type="submit" :disabled="isSubmitting"
                                class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-save mr-2" x-show="!isSubmitting"></i>
                            <i class="fas fa-spinner animate-spin mr-2" x-show="isSubmitting"></i>
                            <span x-show="!isSubmitting">Simpan Data</span>
                            <span x-show="isSubmitting">Menyimpan...</span>
                        </button>
                    </div>

                </form>
            </div>
        </div>

        <!-- Data Tab -->
        <div x-show="activeTab === 'data'" x-transition:enter="transition ease-out duration-300" 
             x-transition:enter-start="opacity-0 transform translate-y-4" 
             x-transition:enter-end="opacity-100 transform translate-y-0">
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 space-y-4 md:space-y-0">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-database mr-2"></i>Data Aset Sekolah
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        <input type="text" x-model="searchTerm" @input="searchData()" 
                               placeholder="Cari data..." 
                               class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button @click="loadData()" 
                                class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
                            <i class="fas fa-sync mr-2"></i>Refresh
                        </button>
                    </div>
                </div>

                <!-- Tabel Data -->
                <div class="overflow-x-auto custom-scrollbar">
                    <table class="w-full responsive-table">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nomor Item</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Item</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kondisi</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bahan</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Gedung</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ruang</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rak</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pencatat</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keterangan</th>
                                <th class="px-2 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="(item, index) in filteredData" :key="index">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="index + 1"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.tanggal"></td>
                                    <td class="px-2 py-3 text-sm font-medium text-gray-900" x-text="item.nomorItem"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.namaItem"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900">
                                        <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800" x-text="item.jenisItem"></span>
                                    </td>
                                    <td class="px-2 py-3 text-sm text-gray-900">
                                        <span :class="getKondisiClass(item.kondisi)" x-text="item.kondisi"></span>
                                    </td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.bahan"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.gedung"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.ruang"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.rak"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.pencatat"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900" x-text="item.keterangan"></td>
                                    <td class="px-2 py-3 text-sm text-gray-900">
                                        <a x-show="item.foto" :href="item.foto" target="_blank" 
                                           class="text-blue-600 hover:text-blue-800">
                                            <i class="fas fa-image"></i>
                                        </a>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    
                    <!-- Empty State -->
                    <div x-show="filteredData.length === 0" class="text-center py-8">
                        <i class="fas fa-inbox text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-500">Belum ada data aset</p>
                    </div>
                </div>

                <!-- Loading State -->
                <div x-show="isLoading" class="text-center py-8">
                    <i class="fas fa-spinner animate-spin text-blue-600 text-2xl"></i>
                    <p class="text-gray-600 mt-2">Memuat data...</p>
                </div>
            </div>
        </div>

        <!-- Setup & Debug Tab -->
        <div x-show="activeTab === 'setup'" x-transition:enter="transition ease-out duration-300" 
             x-transition:enter-start="opacity-0 transform translate-y-4" 
             x-transition:enter-end="opacity-100 transform translate-y-0">
            
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-6 text-gray-800">
                    <i class="fas fa-cog mr-2"></i>Setup & Debug Configuration
                </h2>
                
                <div class="space-y-6">
                    <!-- Configuration Status -->
                    <div class="border-l-4 border-blue-500 pl-4">
                        <h3 class="font-semibold text-lg mb-2">Status Konfigurasi</h3>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <i :class="isConfigured ? 'fas fa-check-circle text-green-500' : 'fas fa-exclamation-circle text-yellow-500'" class="mr-2"></i>
                                <span>Google Apps Script URL: <span x-text="isConfigured ? 'âœ… Terkonfigurasi' : 'âŒ Belum dikonfigurasi'"></span></span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                <span>Hosting: GitHub Pages âœ…</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-shield-alt text-green-500 mr-2"></i>
                                <span>CORS: Configured for GitHub Pages âœ…</span>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Form -->
                    <div class="border-l-4 border-yellow-500 pl-4">
                        <h3 class="font-semibold text-lg mb-2">Konfigurasi Google Apps Script URL</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Web App URL</label>
                                <input type="url" x-model="config.scriptUrl" @input="updateConfig()" 
                                       placeholder="https://script.google.com/macros/s/.../exec"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-sm text-gray-600 mt-1">
                                    Paste URL Web App dari Google Apps Script deployment Anda
                                </p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Spreadsheet ID (Optional)</label>
                                <input type="text" x-model="config.spreadsheetId" 
                                       placeholder="1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-sm text-gray-600 mt-1">
                                    Untuk direct access ke Google Sheet (opsional)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Test Connection -->
                    <div class="border-l-4 border-green-500 pl-4">
                        <h3 class="font-semibold text-lg mb-2">Test Koneksi</h3>
                        <div class="space-y-4">
                            <button @click="testConnection()" 
                                    :disabled="!isConfigured || isTesting"
                                    class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed">
                                <i class="fas fa-plug mr-2"></i>
                                <span x-show="!isTesting">Test Koneksi</span>
                                <span x-show="isTesting">Testing...</span>
                            </button>
                            
                            <div x-show="testResult" class="p-3 rounded-md" :class="testResult.success ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'">
                                <div class="flex items-center">
                                    <i :class="testResult.success ? 'fas fa-check-circle text-green-600' : 'fas fa-exclamation-circle text-red-600'" class="mr-2"></i>
                                    <span x-text="testResult.message"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Debug Information -->
                    <div class="border-l-4 border-purple-500 pl-4">
                        <h3 class="font-semibold text-lg mb-2">Debug Information</h3>
                        <div class="bg-gray-50 p-4 rounded-md">
                            <h4 class="font-medium mb-2">Current Configuration:</h4>
                            <pre class="text-xs bg-white p-2 rounded border overflow-x-auto" x-text="JSON.stringify(config, null, 2)"></pre>
                            
                            <h4 class="font-medium mb-2 mt-4">Browser Console:</h4>
                            <p class="text-sm text-gray-600">Buka browser console (F12) untuk melihat detail error</p>
                            
                            <button @click="clearDebugInfo()" class="mt-2 text-sm text-blue-600 hover:text-blue-800">
                                <i class="fas fa-trash mr-1"></i>Clear Debug Info
                            </button>
                        </div>
                    </div>

                    <!-- Setup Instructions -->
                    <div class="bg-blue-50 p-4 rounded-md">
                        <h3 class="font-semibold text-lg mb-2">ðŸ“‹ Setup Instructions</h3>
                        <ol class="list-decimal list-inside space-y-2 text-sm">
                            <li>Buka <a href="https://script.google.com" target="_blank" class="text-blue-600 hover:underline">Google Apps Script</a></li>
                            <li>Buat project baru dan copy paste <code>Code.gs</code></li>
                            <li>Update konfigurasi di <code>Code.gs</code> (SPREADSHEET_ID, FOLDER_ID)</li>
                            <li>Deploy sebagai Web App dengan access "Anyone"</li>
                            <li>Copy Web App URL dan paste di form di atas</li>
                            <li>Test koneksi dengan tombol "Test Koneksi"</li>
                            <li>Simpan data untuk memastikan semua berfungsi</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div x-show="message.show" x-transition 
             :class="message.type === 'success' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800'"
             class="fixed top-4 right-4 p-4 rounded-lg border shadow-lg z-50 max-w-sm">
            <div class="flex items-center">
                <i :class="message.type === 'success' ? 'fas fa-check-circle text-green-600' : 'fas fa-exclamation-circle text-red-600'" 
                   class="mr-3"></i>
                <p x-text="message.text"></p>
                <button @click="message.show = false" class="ml-auto text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-sm">Â© 2024 Sistem Pendataan Aset Sekolah - GitHub Pages Version</p>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">
                        <i class="fas fa-users mr-1"></i>
                        <span x-text="activeUsers"></span> Pengguna Aktif
                    </span>
                    <span class="text-sm">
                        <i class="fas fa-database mr-1"></i>
                        <span x-text="assetData.length"></span> Total Aset
                    </span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Script -->
    <script>
        function assetApp() {
            return {
                activeTab: 'input',
                activeUsers: Math.floor(Math.random() * 5) + 1,
                isSubmitting: false,
                isLoading: false,
                showCamera: false,
                searchTerm: '',
                isTesting: false,
                isConfigured: false,
                message: {
                    show: false,
                    type: 'success',
                    text: ''
                },
                testResult: null,
                config: {
                    scriptUrl: '',
                    spreadsheetId: ''
                },
                formData: {
                    tanggal: new Date().toISOString().split('T')[0],
                    nomorItem: '',
                    namaItem: '',
                    jenisItem: '',
                    kondisi: '',
                    bahan: '',
                    gedung: '',
                    ruang: '',
                    rak: '',
                    pencatat: '',
                    keterangan: '',
                    foto: null,
                    fotoPreview: '',
                    fotoSize: ''
                },
                assetData: [],
                filteredData: [],
                
                init() {
                    this.loadConfig();
                    this.generateNomorItem();
                    this.loadData();
                    this.simulateActiveUsers();
                },
                
                loadConfig() {
                    const saved = localStorage.getItem('assetAppConfig');
                    if (saved) {
                        this.config = JSON.parse(saved);
                        this.updateConfigStatus();
                    }
                },
                
                saveConfig() {
                    localStorage.setItem('assetAppConfig', JSON.stringify(this.config));
                    this.updateConfigStatus();
                },
                
                updateConfig() {
                    this.saveConfig();
                },
                
                updateConfigStatus() {
                    this.isConfigured = this.config.scriptUrl && this.config.scriptUrl.includes('script.google.com');
                },
                
                async testConnection() {
                    if (!this.isConfigured) {
                        this.showMessage('Please configure Google Apps Script URL first', 'error');
                        return;
                    }
                    
                    this.isTesting = true;
                    this.testResult = null;
                    
                    try {
                        const testUrl = `${this.config.scriptUrl}?action=test&t=${Date.now()}`;
                        
                        // Add CORS workaround for GitHub Pages
                        const response = await fetch(testUrl, {
                            method: 'GET',
                            mode: 'cors',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            this.testResult = {
                                success: true,
                                message: 'âœ… Koneksi berhasil! Google Apps Script merespon dengan baik.'
                            };
                        } else {
                            this.testResult = {
                                success: false,
                                message: `âŒ Error ${response.status}: ${response.statusText}`
                            };
                        }
                    } catch (error) {
                        console.error('Connection test error:', error);
                        this.testResult = {
                            success: false,
                            message: `âŒ Koneksi gagal: ${error.message}. Pastikan Web App sudah di-deploy dengan access "Anyone".`
                        };
                    } finally {
                        this.isTesting = false;
                    }
                },
                
                generateNomorItem() {
                    const timestamp = Date.now().toString().slice(-6);
                    this.formData.nomorItem = timestamp;
                },
                
                async handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.size > 3 * 1024 * 1024) {
                            this.showMessage('Ukuran foto maksimal 3MB', 'error');
                            return;
                        }
                        
                        this.formData.foto = file;
                        this.formData.fotoPreview = URL.createObjectURL(file);
                        this.formData.fotoSize = this.formatFileSize(file.size);
                    }
                },
                
                async openCamera() {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'environment' } 
                        });
                        this.$refs.video.srcObject = stream;
                        this.showCamera = true;
                    } catch (error) {
                        this.showMessage('Tidak dapat mengakses kamera', 'error');
                    }
                },
                
                closeCamera() {
                    if (this.$refs.video.srcObject) {
                        this.$refs.video.srcObject.getTracks().forEach(track => track.stop());
                    }
                    this.showCamera = false;
                },
                
                capturePhoto() {
                    const video = this.$refs.video;
                    const canvas = this.$refs.canvas;
                    const context = canvas.getContext('2d');
                    
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    context.drawImage(video, 0, 0);
                    
                    canvas.toBlob((blob) => {
                        if (blob.size > 3 * 1024 * 1024) {
                            this.showMessage('Ukuran foto terlalu besar, coba lagi', 'error');
                            return;
                        }
                        
                        this.formData.foto = blob;
                        this.formData.fotoPreview = URL.createObjectURL(blob);
                        this.formData.fotoSize = this.formatFileSize(blob.size);
                        this.closeCamera();
                    }, 'image/jpeg', 0.8);
                },
                
                removePhoto() {
                    this.formData.foto = null;
                    this.formData.fotoPreview = '';
                    this.formData.fotoSize = '';
                    this.$refs.fileInput.value = '';
                },
                
                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },
                
                async submitForm() {
                    if (!this.isConfigured) {
                        this.showMessage('Please configure Google Apps Script URL first in Setup tab', 'error');
                        return;
                    }
                    
                    this.isSubmitting = true;
                    
                    try {
                        // Create FormData for file upload
                        const formData = new FormData();
                        
                        // Add all form fields
                        Object.keys(this.formData).forEach(key => {
                            if (key !== 'fotoPreview' && key !== 'fotoSize' && this.formData[key]) {
                                formData.append(key, this.formData[key]);
                            }
                        });
                        
                        // Add action parameter
                        formData.append('action', 'saveData');
                        
                        console.log('Submitting data to:', this.config.scriptUrl);
                        console.log('Form data:', Object.fromEntries(formData));
                        
                        const response = await fetch(this.config.scriptUrl, {
                            method: 'POST',
                            body: formData,
                            mode: 'cors'
                        });
                        
                        console.log('Response status:', response.status);
                        console.log('Response headers:', response.headers);
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('Response data:', result);
                            
                            if (result.status === 'success') {
                                this.showMessage('Data berhasil disimpan!', 'success');
                                this.resetForm();
                                this.loadData();
                            } else {
                                throw new Error(result.message || 'Unknown error');
                            }
                        } else {
                            const errorText = await response.text();
                            console.error('Error response:', errorText);
                            throw new Error(`HTTP ${response.status}: ${errorText}`);
                        }
                    } catch (error) {
                        console.error('Submit error:', error);
                        this.showMessage(`Gagal menyimpan data: ${error.message}`, 'error');
                    } finally {
                        this.isSubmitting = false;
                    }
                },
                
                resetForm() {
                    this.formData = {
                        tanggal: new Date().toISOString().split('T')[0],
                        nomorItem: '',
                        namaItem: '',
                        jenisItem: '',
                        kondisi: '',
                        bahan: '',
                        gedung: '',
                        ruang: '',
                        rak: '',
                        pencatat: '',
                        keterangan: '',
                        foto: null,
                        fotoPreview: '',
                        fotoSize: ''
                    };
                    this.generateNomorItem();
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = '';
                    }
                },
                
                async loadData() {
                    if (!this.isConfigured) {
                        // Load demo data if not configured
                        this.loadDemoData();
                        return;
                    }
                    
                    this.isLoading = true;
                    
                    try {
                        const url = `${this.config.scriptUrl}?action=getData&t=${Date.now()}`;
                        console.log('Loading data from:', url);
                        
                        const response = await fetch(url, {
                            method: 'GET',
                            mode: 'cors'
                        });
                        
                        if (response.ok) {
                            const result = await response.json();
                            console.log('Data response:', result);
                            
                            if (result.status === 'success' && result.data) {
                                this.assetData = result.data;
                                this.filteredData = result.data;
                            } else {
                                throw new Error(result.message || 'Invalid data format');
                            }
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    } catch (error) {
                        console.error('Load data error:', error);
                        this.showMessage(`Gagal memuat data: ${error.message}`, 'error');
                        this.loadDemoData();
                    } finally {
                        this.isLoading = false;
                    }
                },
                
                loadDemoData() {
                    this.assetData = [
                        {
                            tanggal: '2024-01-15',
                            nomorItem: '123456',
                            namaItem: 'Laptop ASUS',
                            jenisItem: 'komputer',
                            kondisi: 'baik',
                            bahan: 'metal',
                            gedung: 'gedung 1',
                            ruang: 'ruang 3',
                            rak: 'A-1',
                            pencatat: 'Ludiah Liling, S.Pd',
                            keterangan: 'Laptop untuk guru',
                            foto: 'https://via.placeholder.com/100'
                        }
                    ];
                    this.filteredData = this.assetData;
                },
                
                searchData() {
                    if (!this.searchTerm) {
                        this.filteredData = this.assetData;
                        return;
                    }
                    
                    const term = this.searchTerm.toLowerCase();
                    this.filteredData = this.assetData.filter(item => 
                        Object.values(item).some(value => 
                            value && value.toString().toLowerCase().includes(term)
                        )
                    );
                },
                
                getKondisiClass(kondisi) {
                    const classes = {
                        'baru': 'px-2 py-1 text-xs rounded-full bg-green-100 text-green-800',
                        'baik': 'px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800',
                        'rusak ringan': 'px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800',
                        'rusak parah': 'px-2 py-1 text-xs rounded-full bg-red-100 text-red-800'
                    };
                    return classes[kondisi] || 'px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-800';
                },
                
                showMessage(text, type = 'success') {
                    this.message = {
                        show: true,
                        type: type,
                        text: text
                    };
                    
                    setTimeout(() => {
                        this.message.show = false;
                    }, 5000);
                },
                
                clearDebugInfo() {
                    this.testResult = null;
                    localStorage.removeItem('assetAppConfig');
                    this.config = { scriptUrl: '', spreadsheetId: '' };
                    this.updateConfigStatus();
                    this.showMessage('Debug info cleared', 'success');
                },
                
                simulateActiveUsers() {
                    setInterval(() => {
                        this.activeUsers = Math.floor(Math.random() * 5) + 1;
                    }, 30000);
                }
            }
        }
    </script>
</body>
</html>
